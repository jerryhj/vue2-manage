webpackJsonp([2],{194:function(e,t,n){n(479);var r=n(83)(n(372),n(498),null,null);e.exports=r.exports},197:function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return a});var r="",a=void 0;r="",a="/static/",t.b={token:""}},199:function(e,t,n){"use strict";n.d(t,"J",function(){return a}),n.d(t,"H",function(){return s}),n.d(t,"I",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"a",function(){return l}),n.d(t,"c",function(){return u}),n.d(t,"d",function(){return c}),n.d(t,"E",function(){return d}),n.d(t,"F",function(){return f}),n.d(t,"G",function(){return p}),n.d(t,"B",function(){return m}),n.d(t,"C",function(){return b}),n.d(t,"D",function(){return v}),n.d(t,"w",function(){return h}),n.d(t,"y",function(){return _}),n.d(t,"t",function(){return g}),n.d(t,"u",function(){return x}),n.d(t,"A",function(){return w}),n.d(t,"v",function(){return y}),n.d(t,"f",function(){return k}),n.d(t,"l",function(){return T}),n.d(t,"q",function(){return O}),n.d(t,"j",function(){return S}),n.d(t,"k",function(){return P}),n.d(t,"s",function(){return $}),n.d(t,"n",function(){return E}),n.d(t,"m",function(){return C}),n.d(t,"p",function(){return z}),n.d(t,"o",function(){return j}),n.d(t,"z",function(){return D}),n.d(t,"r",function(){return M}),n.d(t,"i",function(){return V}),n.d(t,"e",function(){return I}),n.d(t,"g",function(){return q}),n.d(t,"x",function(){return F}),n.d(t,"h",function(){return R});var r=n(204),a=function(e){return n.i(r.a)("/admin/login",e,"POST")},s=function(e){return n.i(r.a)("/admin/signup",e,"POST")},i=function(e){return n.i(r.a)("/admin/forgetpasswd",e,"POST")},o=function(){return n.i(r.a)("/admin/refresh_token")},l=function(){return n.i(r.a)("/admin/info")},u=function(e){return n.i(r.a)("/admin/change_password",e,"POST")},c=function(e){return n.i(r.a)("/statis/jobinfo",{query_time:e},"POST")},d=function(){return n.i(r.a)("/statis/all_store_size")},f=function(){return n.i(r.a)("/statis/all_rc_size")},p=function(){return n.i(r.a)("/statis/all_remoterc_size")},m=function(e){return n.i(r.a)("/statis/store_size",{query_time:e},"POST")},b=function(e){return n.i(r.a)("/statis/rc_size",{query_time:e},"POST")},v=function(e){return n.i(r.a)("/statis/remoterc_size",{query_time:e},"POST")},h=function(e){return n.i(r.a)("/policy/assign",e,"POST")},_=function(){return n.i(r.a)("/policy/getname")},g=function(){return n.i(r.a)("/policy/count")},x=function(e){return n.i(r.a)("/policy",e)},w=function(e){return n.i(r.a)("/policy/add",e,"POST")},y=function(e){return n.i(r.a)("/policy/"+e,{},"DELETE")},k=function(){return n.i(r.a)("/vm/getname")},T=function(e){return n.i(r.a)("/vm/sess/"+e)},O=function(e){return n.i(r.a)("/vm/installkey/"+e)},S=function(){return n.i(r.a)("/vm/count")},P=function(e){return n.i(r.a)("/vm",e)},$=function(e){return n.i(r.a)("/vm/add",e,"POST")},E=function(e){return n.i(r.a)("/vm/recovery",e,"POST")},C=function(e){return n.i(r.a)("/vm/"+e,{},"DELETE")},z=function(e){return n.i(r.a)("/undepolyvm",e)},j=function(){return n.i(r.a)("/undepolyvm/count")},D=function(e){return n.i(r.a)("/undepolyvm/add",e,"POST")},M=function(e){return n.i(r.a)("/undepolyvm/"+e,{},"DELETE")},V=function(e){return n.i(r.a)("/instantvm/bindvm",e,"POST")},I=function(){return n.i(r.a)("/instantvm/count")},q=function(e){return n.i(r.a)("/instantvm",e)},F=function(e){return n.i(r.a)("/instantvm/add",e,"POST")},R=function(e){return n.i(r.a)("/instantvm/"+e,{},"DELETE")}},204:function(e,t,n){"use strict";var r=n(82),a=n.n(r),s=n(21),i=n.n(s),o=n(84),l=n.n(o),u=n(205),c=n.n(u),d=n(206),f=n.n(d),p=n(81),m=n.n(p),b=n(197),v=this;t.a=function(){var e=m()(a.a.mark(function e(){var t,n,r,s,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fetch";return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d=d.toUpperCase(),o=b.c+o,"GET"==d&&(t="",f()(u).forEach(function(e){t+=e+"="+u[e]+"&"}),""!==t&&(t=t.substr(0,t.lastIndexOf("&")),o=o+"?"+t)),!window.fetch||"fetch"!=p){e.next=21;break}return n={credentials:"include",method:d,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+b.b.token},mode:"cors",cache:"no-cache"},"POST"==d&&Object.defineProperty(n,"body",{value:c()(u)}),e.prev=6,e.next=9,fetch(o,n);case 9:return r=e.sent,e.next=12,r.json();case 12:return s=e.sent,e.abrupt("return",s);case 16:throw e.prev=16,e.t0=e.catch(6),new Error(e.t0);case 19:e.next=22;break;case 21:return e.abrupt("return",new l.a(function(e,t){var n=void 0;n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject;var r="";"POST"==d&&(r=c()(u)),n.open(d,o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(r),n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status){var r=n.response;"object"!==(void 0===r?"undefined":i()(r))&&(r=JSON.parse(r)),e(r)}else t(n)}}));case 22:case"end":return e.stop()}},e,v,[[6,16]])}));return function(){return e.apply(this,arguments)}}()},205:function(e,t,n){e.exports={default:n(207),__esModule:!0}},206:function(e,t,n){e.exports={default:n(208),__esModule:!0}},207:function(e,t,n){var r=n(5),a=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},208:function(e,t,n){n(210),e.exports=n(5).Object.keys},209:function(e,t,n){var r=n(13),a=n(5),s=n(17);e.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],i={};i[e]=t(n),r(r.S+r.F*s(function(){n(1)}),"Object",i)}},210:function(e,t,n){var r=n(30),a=n(22);n(209)("keys",function(){return function(e){return a(r(e))}})},215:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(82),a=n.n(r),s=n(81),i=n.n(s),o=n(49),l=n.n(o),u=(n(199),n(197)),c=n(85);t.default={data:function(){return{baseImgPath:u.a}},created:function(){this.adminInfo.id||this.getAdminData()},computed:l()({},n.i(c.b)(["adminInfo"])),methods:l()({},n.i(c.c)(["getAdminData"]),{handleCommand:function(e){var t=this;return i()(a.a.mark(function n(){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:"home"==e?t.$router.push("/manage"):"signout"==e&&(t.$message({type:"success",message:"退出成功"}),t.$router.push("/"),u.b.token="");case 1:case"end":return n.stop()}},n,t)}))()}})}},216:function(e,t,n){t=e.exports=n(178)(!1),t.push([e.i,".allcover{position:absolute;top:0;right:0}.ctt{left:50%;transform:translate(-50%,-50%)}.ctt,.tb{position:absolute;top:50%}.tb{transform:translateY(-50%)}.lr{position:absolute;left:50%;transform:translateX(-50%)}.header_container{background-color:#eff2f7;height:60px;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-align:center;align-items:center;padding-left:20px}.avator{width:36px;height:36px;border-radius:50%;margin-right:37px}.el-dropdown-menu__item{text-align:center}",""])},218:function(e,t,n){var r=n(216);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);n(179)("019239ba",r,!0)},219:function(e,t,n){n(218);var r=n(83)(n(215),n(220),null,null);e.exports=r.exports},220:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"header_container"},[n("el-breadcrumb",{attrs:{separator:"/"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/manage"}}},[e._v("首页")]),e._v(" "),e._l(e.$route.meta,function(t,r){return n("el-breadcrumb-item",{key:r},[e._v(e._s(t))])})],2),e._v(" "),n("el-dropdown",{attrs:{"menu-align":"start"},on:{command:e.handleCommand}},[n("img",{staticClass:"avator",attrs:{src:e.baseImgPath+e.adminInfo.avatar}}),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"home"}},[e._v("首页")]),e._v(" "),n("el-dropdown-item",{attrs:{command:"signout"}},[e._v("退出")])],1)],1)],1)},staticRenderFns:[]}},372:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(49),a=n.n(r),s=n(82),i=n.n(s),o=n(81),l=n.n(o),u=n(219),c=n.n(u),d=n(197),f=n(199);t.default={data:function(){return{baseUrl:d.c,baseImgPath:d.a,restaurant_id:null,city:{},offset:0,limit:20,count:0,tableData:[],privlist:{9:"低",5:"中",1:"高"},statuslist:{0:"配置中",1:"正常",2:"异常",3:"未连接"},arealist:{0:"未知",1048833:"阿里云北京",1049089:"阿里云上海",1049345:"阿里云深圳",1049601:"阿里云杭州",1049857:"阿里云青岛",1050113:"阿里云张家口",1050369:"阿里云呼和浩特",1050625:"阿里云成都",2097409:"腾讯云北京",2097665:"腾讯云上海",2097921:"腾讯云广州",2098177:"腾讯云南京",2098433:"腾讯云成都",2098689:"腾讯云重庆",3145985:"华为云北京",3146241:"华为云上海",3146497:"华为云广州",3146753:"华为云贵阳",4194561:"百度云北京",4194817:"百度云苏州",4195073:"百度云广州",4195329:"百度云保定"},s3arealist:{0:"未知",1048833:"阿里云北京",1049089:"阿里云上海",1049345:"阿里云深圳",1049601:"阿里云杭州",1049857:"阿里云青岛",1050113:"阿里云张家口",1050369:"阿里云呼和浩特",2097409:"腾讯云北京",2097665:"腾讯云上海",2097921:"腾讯云广州",2098177:"腾讯云南京",2098433:"腾讯云成都",2098689:"腾讯云重庆"},priv:[{value:9,label:"低"},{value:5,label:"中"},{value:1,label:"高"}],sesslist:[{}],currentPage:1,selectTable:{},is_remote:!1,dialogFormVisible:!1,menuOptions:[],selectMenu:{},selectIndex:null,foodrules:{ipaddr:[{required:!0,message:"请输入虚拟机IP地址",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},specsFormVisible:!1,expendRow:[]}},created:function(){},activated:function(){this.restaurant_id=this.$route.query.restaurant_id,this.initData()},computed:{},components:{headTop:c.a},methods:{initData:function(){var e=this;return l()(i.a.mark(function t(){var r,a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.i(f.j)();case 3:if(r=t.sent,1!=r.status){t.next=8;break}e.count=r.count,t.next=9;break;case 8:throw new Error("获取数据失败");case 9:return e.getVMs(),t.next=12,n.i(f.b)();case 12:a=t.sent,a.token&&(d.b.token=a.token),t.next=23;break;case 16:t.prev=16,t.t0=t.catch(0),s="会话过期，请重新登录",e.$router.push("/"),d.b.token="",e.$message({type:"error",message:s}),console.log("获取数据失败",t.t0);case 23:case"end":return t.stop()}},t,e,[[0,16]])}))()},getVMs:function(){var e=this;return l()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.i(f.k)({offset:e.offset,limit:e.limit});case 2:r=t.sent,e.tableData=[],r.forEach(function(t,n){var r={};r.vmname=t.vmname,r.item_id=t.id,r.policy_name=t.policy_name,r.policy=t.policy_name,r.realsize=Math.round(100*t.realsize/1024/1024/1024)/100+"GB",r.status=e.statuslist[t.status],r.priority=t.priority,r._priv=e.privlist[t.priority],r._area=e.arealist[t.area],r._s3area=e.s3arealist[t.s3area],r.next_time=t.next_time,r.latest_backup_endtime=t.latest_backup_endtime,r.image_path=t.image_path,r.specfoods=t.specfoods,r.index=n,e.tableData.push(r)});case 5:case"end":return t.stop()}},t,e)}))()},tableRowClassName:function(e,t){return 1===t?"info-row":3===t?"positive-row":""},handleSizeChange:function(e){console.log("每页 "+e+" 条")},handleCurrentChange:function(e){this.currentPage=e,this.offset=(e-1)*this.limit,this.getVMs()},expand:function(e,t){},handleEdit:function(e){var t=this;return l()(i.a.mark(function r(){var a,s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.getSelectItemData(e,"edit"),t.dialogFormVisible=!0,r.prev=2,r.next=5,n.i(f.l)(e.item_id);case 5:a=r.sent,1==a.status?(a.category_list.map(function(e,t){e.value=e.id,e.label=e.optime}),t.selectTable.sesslist=a.category_list,t.sesslist=a.category_list):console.log(a),r.next=15;break;case 9:r.prev=9,r.t0=r.catch(2),s="会话过期，请重新登录",t.$router.push("/"),d.b.token="",console.log(r.t0);case 15:case"end":return r.stop()}},r,t,[[2,9]])}))()},getSelectItemData:function(e,t){var n=this;return l()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.selectTable=a()({},e),n.tableData.splice(e.index,1,a()({},n.selectTable)),n.$nextTick(function(){n.expendRow.push(e.index)});case 3:case"end":return t.stop()}},t,n)}))()},handleSelect:function(e){this.selectIndex=e,this.selectMenu=this.menuOptions[e]},handleDelete:function(e,t){var r=this;return l()(i.a.mark(function e(){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.i(f.m)(t.item_id);case 3:if(a=e.sent,1!=a.status){e.next=9;break}r.$message({type:"success",message:"删除被保护虚拟机成功"}),r.getVMs(),e.next=10;break;case 9:throw new Error(a.message);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),r.$message({type:"error",message:e.t0.message}),console.log("删除被保护虚拟机失败");case 16:case"end":return e.stop()}},e,r,[[0,12]])}))()},recoveryVM:function(e){var t=this;return l()(i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t.$refs[e].validate(function(){var e=l()(i.a.mark(function e(r){var s,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=15;break}return t.dialogFormVisible=!1,s=a()({},t.selectTable),e.prev=3,e.next=6,n.i(f.n)(t.selectTable);case 6:o=e.sent,1==o.status?(t.$message({type:"success",message:"即时恢复开始"}),t.getVMs()):t.$message({type:"error",message:o.message}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log("恢复VM失败",e.t0);case 13:e.next=17;break;case 15:return t.$notify.error({title:"错误",message:"请检查输入是否正确",offset:100}),e.abrupt("return",!1);case 17:case"end":return e.stop()}},e,t,[[3,10]])}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return r.stop()}},r,t)}))()}}}},392:function(e,t,n){t=e.exports=n(178)(!1),t.push([e.i,".allcover{position:absolute;top:0;right:0}.ctt{left:50%;transform:translate(-50%,-50%)}.ctt,.tb{position:absolute;top:50%}.tb{transform:translateY(-50%)}.lr{position:absolute;left:50%;transform:translateX(-50%)}.demo-table-expand{font-size:0}.demo-table-expand label{width:90px;color:#99a9bf}.demo-table-expand .el-form-item{margin-right:0;margin-bottom:0;width:50%}.table_container{padding:20px}.Pagination{display:-ms-flexbox;display:flex;-ms-flex-pack:start;justify-content:flex-start;margin-top:8px}.avatar-uploader .el-upload{border:1px dashed #d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden}.avatar-uploader .el-upload:hover{border-color:#20a0ff}.avatar-uploader-icon{font-size:28px;color:#8c939d;width:120px;height:120px;line-height:120px;text-align:center}.avatar{width:120px;height:120px;display:block}",""])},479:function(e,t,n){var r=n(392);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);n(179)("bbe9d500",r,!0)},498:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fillcontain"},[n("head-top"),e._v(" "),n("div",{staticClass:"table_container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"expand-row-keys":e.expendRow,"row-key":function(e){return e.index}},on:{expand:e.expand}},[n("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[n("el-form-item",{attrs:{label:"当前状态"}},[n("span",[e._v(e._s(t.row.status))])]),e._v(" "),n("el-form-item",{attrs:{label:"备份优先级"}},[n("span",[e._v(e._s(t.row._priv))])]),e._v(" "),n("el-form-item",{attrs:{label:"所在区域"}},[n("span",[e._v(e._s(t.row._area))])]),e._v(" "),n("el-form-item",{attrs:{label:"备份至"}},[n("span",[e._v(e._s(t.row._s3area))])]),e._v(" "),n("el-form-item",{attrs:{label:"下次备份时间"}},[n("span",[e._v(e._s(t.row.next_time))])]),e._v(" "),n("el-form-item",{attrs:{label:"最近备份完成时间"}},[n("span",[e._v(e._s(t.row.latest_backup_endtime))])])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"被保护虚拟机名称",prop:"vmname"}}),e._v(" "),n("el-table-column",{attrs:{label:"当前策略",prop:"policy_name"}}),e._v(" "),n("el-table-column",{attrs:{label:"磁盘空间",prop:"realsize"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"small"},on:{click:function(n){return e.handleEdit(t.row)}}},[e._v("恢复")]),e._v(" "),n("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),n("div",{staticClass:"Pagination"},[n("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":20,layout:"total, prev, pager, next",total:e.count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),n("el-dialog",{attrs:{title:"恢复被保护虚拟机"},model:{value:e.dialogFormVisible,callback:function(t){e.dialogFormVisible=t},expression:"dialogFormVisible"}},[n("el-form",{ref:"selectTable",attrs:{model:e.selectTable,rules:e.foodrules}},[n("el-form-item",{attrs:{label:"待恢复的VM","label-width":"100px"}},[n("el-input",{attrs:{"auto-complete":"off",disabled:""},model:{value:e.selectTable.vmname,callback:function(t){e.$set(e.selectTable,"vmname",t)},expression:"selectTable.vmname"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"备份时间点","label-width":"100px",prop:"sesslist"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.selectTable.sessid,callback:function(t){e.$set(e.selectTable,"sessid",t)},expression:"selectTable.sessid"}},e._l(e.sesslist,function(e){return n("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"会话密码","label-width":"100px",prop:"sess_password"}},[n("el-input",{model:{value:e.selectTable.sess_password,callback:function(t){e.$set(e.selectTable,"sess_password",t)},expression:"selectTable.sess_password"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"IP地址","label-width":"100px",prop:"ipaddr"}},[n("el-input",{model:{value:e.selectTable.ipaddr,callback:function(t){e.$set(e.selectTable,"ipaddr",t)},expression:"selectTable.ipaddr"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"用户名","label-width":"100px",prop:"username"}},[n("el-input",{model:{value:e.selectTable.username,callback:function(t){e.$set(e.selectTable,"username",t)},expression:"selectTable.username"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"用户密码","label-width":"100px",prop:"password"}},[n("el-input",{attrs:{type:"password"},model:{value:e.selectTable.password,callback:function(t){e.$set(e.selectTable,"password",t)},expression:"selectTable.password"}})],1),e._v(" "),n("el-form-item",{staticStyle:{"white-space":"nowrap"},attrs:{label:"异地恢复","label-width":"100px"}},[n("el-switch",{attrs:{"on-text":"","off-text":""},model:{value:e.selectTable.is_remote,callback:function(t){e.$set(e.selectTable,"is_remote",t)},expression:"selectTable.is_remote"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.recoveryVM("selectTable")}}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]}}});